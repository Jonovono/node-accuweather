{"version":3,"sources":["../../src/index.js"],"names":["request","require","accuweather","API_KEY","baseUrl","queryLocations","params","url","qs","apikey","q","query","json","then","resp","catch","console","error","err","getFirstLocationKey","body","Key","undefined","getCurrentConditions","options","Array","isArray","TypeError","unit","locationKey","isNaN","Promise","resolve","parseInt","key","reject","details","Summary","WeatherText","Temperature","Imperial","Value","RealFeel","RealFeelTemperature","Precipitation","Precip1hr","Metric","module","exports"],"mappings":"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","file":"index.js","sourcesContent":["const request = require('request-promise')\n\nconst accuweather = () => {\n  return (API_KEY) => {\n    const baseUrl = 'http://dataservice.accuweather.com'\n\n    // Queries all location keys based on keyword search\n    const queryLocations = query => {\n      const params = {\n        url: baseUrl + '/locations/v1/cities/autocomplete',\n        qs: {apikey: API_KEY, q: query},\n        json: true\n      }\n      return request(params)\n        .then(resp => resp)\n        .catch(err => console.error(err))\n    }\n\n    // Gets the first result for AccuWeather-specific location keys so that a query can be made to get the weather\n    const getFirstLocationKey = query => queryLocations(query)\n        .then(([body,]) => body ? body.Key : undefined)\n        .catch(err => console.error(err))\n\n    // Gets location key from object containing { lat: Number, long: Number }\n    // const getGeoLocation = ({lat, long}) => {\n    //   const queryString = lat.toString() + ', ' + long.toString()\n    //   const params = {\n    //     url: baseUrl + '/locations/v1/cities/geoposition/search',\n    //     qs {apikey: API_KEY, q: queryString},\n    //     json: true\n    //   }\n    //   return request(params)\n    //     .then(resp => resp)\n    //     .catch(err => console.error(err))\n    // }\n\n    /*\n    Takes string of keyword, string/number of location key,\n    or object containing {lat: Number, long: Number}\n     */\n    const getCurrentConditions = (query, options) => {\n      if ((typeof query !== 'string' && typeof query !== 'number')\n        || Array.isArray(query)) {\n        throw new TypeError('Query argument should be string, number, or object, instead received ' + typeof query)\n      }\n\n      const unit = options ? options.unit : \"Farenheit\"\n      // If query is a string, then do a keyword search and return the most relevant result's location key.\n      // If query is a number (it is the location Key) then use that key\n      const locationKey = isNaN(query) ? getFirstLocationKey(query) : Promise.resolve(parseInt(query))\n      return locationKey\n        .then(key => key ? key : Promise.reject('No result found for query'))\n        .then(key => {\n          const params = {\n            url: baseUrl + '/currentconditions/v1/' + key,\n            qs: {apikey: API_KEY, details: true},\n            json: true\n          }\n          return request(params)\n        })\n        .then(([body,]) => {\n          if (unit == \"Farenheit\") {\n            return {\n              Summary: body.WeatherText,\n              Temperature: body.Temperature.Imperial.Value,\n              RealFeel: body.RealFeelTemperature.Imperial.Value,\n              Precipitation: body.Precip1hr.Imperial\n            }\n          } else {\n            return {\n              Summary: body.WeatherText,\n              Temperature: body.Temperature.Metric.Value,\n              RealFeel: body.RealFeelTemperature.Metric.Value,\n              Precipitation: body.Precip1hr.Metric\n            }\n          }\n        })\n        .catch(err => console.error(err))\n    }\n\n    // getGeoLocation({lat: 40.7128, long: -74.0059})\n    //   .then(result => console.log(result))\n\n    return {\n      // getGeoLocation,\n      queryLocations,\n      getCurrentConditions\n    }\n  }\n}\n\nmodule.exports = accuweather"]}